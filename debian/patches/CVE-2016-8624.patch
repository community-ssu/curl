From 44ab42e55bbe329777ee05d50aea1ee059221652 Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Tue, 11 Oct 2016 00:48:35 +0200
Subject: [PATCH] urlparse: accept '#' as end of host name

'http://example.com#@127.0.0.1/x.txt' equals a request to example.com
for the '/' document with the rest of the URL being a fragment.
---
 lib/url.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

Index: curl-7.26.0/lib/url.c
===================================================================
--- curl-7.26.0.orig/lib/url.c	2016-11-01 13:36:46.990264163 +0100
+++ curl-7.26.0/lib/url.c	2016-11-01 13:43:49.954671482 +0100
@@ -3841,7 +3841,7 @@
     path[0]=0;
 
     if(2 > sscanf(data->change.url,
-                   "%15[^\n:]://%[^\n/?]%[^\n]",
+                   "%15[^\n:]://%[^\n/?#]%[^\n]",
                    protobuf,
                    conn->host.name, path)) {
 
@@ -3849,7 +3849,7 @@
        * The URL was badly formatted, let's try the browser-style _without_
        * protocol specified like 'http://'.
        */
-      rc = sscanf(data->change.url, "%[^\n/?]%[^\n]", conn->host.name, path);
+      rc = sscanf(data->change.url, "%[^\n/?#]%[^\n]", conn->host.name, path);
       if(1 > rc) {
         /*
          * We couldn't even get this format.
@@ -3930,10 +3930,10 @@
   }
 
   /* If the URL is malformatted (missing a '/' after hostname before path) we
-   * insert a slash here. The only letter except '/' we accept to start a path
-   * is '?'.
+   * insert a slash here. The only letters except '/' that can start a path is
+   * '?' and '#' - as controlled by the two sscanf() patterns above.
    */
-  if(path[0] == '?') {
+  if(path[0] != '/') {
     /* We need this function to deal with overlapping memory areas. We know
        that the memory area 'path' points to is 'urllen' bytes big and that
        is bigger than the path. Use +1 to move the zero byte too. */
